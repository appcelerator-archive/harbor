This file describes how to build a harbor auth server docker image for use in arrowcloud. 


The harbor's original Makefile file builds 4 docker images: mysql, ui, jobservice, and log. "ui" is actually the auth server. Some changes was made to build ui (auth server) only. Specificially changes were made in:

* **database**: mysql was replaced by mongo
* **configuration**: app configuration was moved to *make/common/templates/ui/app.conf.template*
* **authentication**: use arrowcloud sessionID
* **Makefile**: compile binary for linux and don't build mysql docker image
* **make/photon/Makefile**: don't build jobservice and log docker images
* **make/photon/ui/Dockerfile**: include consul-template to read configuration from consul.


It's very easy to build auth server docker image follwing the steps below.

## generate binary
```
make compile
```

This compiles code for ui and jobservice. Since we don't use jobservice just ignore it. (jobservice is a separate module running docker image replication tasks.)
The generated binary file will be located at **make/dev/ui/harbor_ui**.

## build image
```
make build -e DEVFLAG=false DOCKERIMAGENAME_UI=registry.cloudapp-enterprise-preprod.appctest.com:5000/ypjin/harbor_ui
```

This builds the docker image for ui (auth server) using vmware photon base image. It adds to the image a tag *like 0.5.0-9-gc64025c* generated by the following command.
```
git describe --tags
```

Note that you can specify any repo name for the image by changing *DOCKERIMAGENAME_UI* option.

## push image to registry
You can do anything using docker directly.




